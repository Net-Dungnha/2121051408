{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Create s3-bucket with cloudtrail for logging",
     "Parameter": {
        "SetAccount":{
            "Type": "String",
            "Description": "bucket name only accepts lowercase characters no special characters",
            "AllowedPattern": "^[a-z0-9-]+$"
        },
        "SetBucket":{
            "Type": "String",
            "Description": "bucket name only accepts lowercase characters no special characters",
            "AllowedPattern": "^[a-z0-9-]+$"
        }
     },
     "Resources": {
        "S3Bucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "Fn ::Sub": "${SetBucketN}-cloudtrail-logs"
            } 
        },
        "BucketPolicy": {
            "Type": "AWS::S3::BucketPolicy",
            "Properties": {
                "Bucket": {
                    "Ref": "S3Bucket"
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "cloudtrail.amazonaws.com"
                            },
                            "Action": "s3:GetBucketAcl",
                            "Resource": {
                                "Fn::GetAtt": [
                                    "S3Bucket",
                                    "Arn"
                                ]
                            }
                        },
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "cloudtrail.amazonaws.com"
                            },
                            "Action": "s3:PutObject",
                            "Resource": {
                                "Fn::Sub": "${S3Bucket.Arn}/AWSLogs/${SetAccount}/*"
                            },
                            "Condition": {
                                "StringEquals": {
                                    "s3:x-amz-acl": "bucket-owner-full-control"
                                }
                            }
                        }
                    ]
                }
                
            },
            "DependsOn": "BucketPolicy"
        },
        ""
        
    }       
        
}